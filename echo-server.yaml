apiVersion: v1
kind: Secret
type: Opaque
data:
  fullchain.pem: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURZekNDQWt1Z0F3SUJBZ0lKQVBVeUFmcExHYnQzTUEwR0NTcUdTSWIzRFFFQkJRVUFNR2N4Q3pBSkJnTlYKQkFZVEFsVlRNUTB3Q3dZRFZRUUlEQVJWZEdGb01RNHdEQVlEVlFRSERBVlFjbTkyYnpFak1DRUdBMVVFQ2d3YQpRVU5OUlNCVGFXZHVhVzVuSUVGMWRHaHZjbWwwZVNCSmJtTXhGREFTQmdOVkJBTU1DMlY0WVcxd2JHVXVZMjl0Ck1CNFhEVEl3TURVeE1USXhNemt3TlZvWERUUTNNRGt5TmpJeE16a3dOVm93WFRFTE1Ba0dBMVVFQmhNQ1ZWTXgKRFRBTEJnTlZCQWdNQkZWMFlXZ3hEakFNQmdOVkJBY01CVkJ5YjNadk1SWXdGQVlEVlFRS0RBMUJZMjFsSUZSbApZMmdnU1c1ak1SY3dGUVlEVlFRRERBNXRlUzVsZUdGdGNHeGxMbU52YlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCCkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUxkR0RONkdVeXhHMU15a3R1Um9acndKbXZ4UDlvOFg2T0w5ZTRDaTJBUHgKM3o4NVQvdWZLUFVjemd2K2JWWTRRb3VPQmNZOUs3SzdzS2V6UFZ4QzVBOFNUcG5FK2lGK3ZtU3BpKzViQStzeQpYbmFyTnNJTlhGeVJjUExDV2dHNlRsazh4NTVkZkxKT0pmNitCRDQyeEZSY3JTY0ZRYjliY1o2L2lkMWZmZFlWCnJ0cVQrSVlpbkFORzFSam91cE9nVHhnd292VlUwcEdqSGpMUFViSHhXVmFqWllmdlBNck83dDJqYmduZ0NJMHoKbXZ5MjEyeGNyOGNNV2xDTzBkZ3pnV1dURG43M2dNb1lkbDA2c0ZteHErZEhsQ0xtTUxrcWVPWGF0dFhXYk84NApOelQ2L1ZNZWxPU1FTQUtCQk5ncFJkVlVSTWtNMEJjL3UvNzZVdUF5eTZVQ0F3RUFBYU1jTUJvd0dBWURWUjBSCkJCRXdENFlOYzNCcFptWmxPaTh2WldOb2J6QU5CZ2txaGtpRzl3MEJBUVVGQUFPQ0FRRUFoQWYreURSbDZsTnYKVU15THZqQUw3WGlOSVFBNksxTFdnZWMrSlI0aVZDQ3czdHRHRlNjb2xlVmc3Qi9pR21rdU5ZQU55cnRCRGFKUQpnMmw3WVIxb0tiRzBtcngvQTBPWm96RjJPRWlGUWJxdm5WZmlkU3ZIc3AvYUtzZnl5ZDNwbFZ6MHNwN04zVmZkClpUUFk4c21xK1pxSjBmOXhwNEZYcFhFT2FrV1l4UklRTzJKaXUwZElCcTZpMWVFM25weUd6Zi9vZ3VtejYyM3oKOVZmL2JGTk9pbWxKQWRUbFFSeGR5cWdBeWI0TERtNC8xM3dLVHF6WjR3VWZnWjQ3VnhPN3g0MW9za3hRWUd0eQphNnF3MHRyNExhMXVrZHFDRzRSK1FUaTV4eE5VK1Z0bFJSK1hyQmhlSGx0K0swUFlNQlVHc1J6R1hSMHYzalBnClA3Lzd0TFV6RGc9PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
  privkey.pem: LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2d0lCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktrd2dnU2xBZ0VBQW9JQkFRQzNSZ3plaGxNc1J0VE0KcExia2FHYThDWnI4VC9hUEYramkvWHVBb3RnRDhkOC9PVS83bnlqMUhNNEwvbTFXT0VLTGpnWEdQU3V5dTdDbgpzejFjUXVRUEVrNlp4UG9oZnI1a3FZdnVXd1ByTWw1MnF6YkNEVnhja1hEeXdsb0J1azVaUE1lZVhYeXlUaVgrCnZnUStOc1JVWEswbkJVRy9XM0dldjRuZFgzM1dGYTdhay9pR0lwd0RSdFVZNkxxVG9FOFlNS0wxVk5LUm94NHkKejFHeDhWbFdvMldIN3p6S3p1N2RvMjRKNEFpTk01cjh0dGRzWEsvSERGcFFqdEhZTTRGbGt3NSs5NERLR0haZApPckJac2F2blI1UWk1akM1S25qbDJyYlYxbXp2T0RjMCt2MVRIcFRra0VnQ2dRVFlLVVhWVkVUSkROQVhQN3YrCitsTGdNc3VsQWdNQkFBRUNnZ0VBVVZWSkNNZmJ5VjUxdVl1dmpwVzJZZVJ4WDErdEw3dVFvb3VUYjNiVkhvc00KWStadlZGOUJzZVZpbTNnQjFhMkorcHpBZTBWU1N6TjRKalFwR3ZTa2VQdkszZnJJZG16azJZOVVoaWJtQ2s2RQpGVzNPRXpnU3NSSHFhaEZPR0U0eHp2Qm1OaVdPM1NKSlFrL1pXaks3MWlSNncwSlY5eklCcmsyYVJSL0huR1dxCnZHeCtDNXNRTVM0VCtFK25IdU5VUHI0eVYzaFR1eUw4TWI3dXZwT1FzcWxueEROSU0yaTdjQU90clBablB2YnYKaU5PdXIreURmNHNiRUVNWVBqQzcvdXEzcTVhTkYrYXBkYlFYbW53Mm5QbnlmSVNlWmljTXZxa2YxTGpXRUFlSgprTmRzR2s1KzFmeFpWN0RPYzRGRSs4UTV4eDExdWlKYWVUSFBKTG9jQVFLQmdRRGFtQ0drL3pwV0FkL3FjS0FlCjBzU3dwalR6YkdLNzFPc2lCOEFBK3gxdEl5TytCUkJXZVdQdDNqWXRJZTc1NFh2OElhMnlZNkxQMDY4S3pyUmsKZTR6ZmEwVGM3VVBwL0gwTEdzU3R6VnJFd1JmaHcxUE5uQUlvY1BGZDl6WE8vVE5pZWZMUmlKTTJvU2d0bVNTRQpjeHlaUnM0V1NmUkpVcTVPUmc5cXpjMXlRUUtCZ1FEV29xU0MvS3RtWlNDWWJML21PMXlHUFNZc01XM3NkT2VwCnZTNmxlNDFFRDhkak9tS1RUdWowVVBFaEVtLzdTMHd0aGFDTGZtOUYrK1d2VUpQbWdLa1QvRW5YR1R2eDc1N2IKZ0NybUpjZDBVd0JxcXRydENTNThScXFlZnRyVHZIUHZQVGxIUmhGVGN6b09lYi9nT3FrOXlEaFNoVHFReFVXRApsemlBdG9hNFpRS0JnUUN4bWc4ajNwYUlFS2ZiODd1MHIyeE5WZzBKaGhOR0p2MFB2aG82OGN2N3d5UWtIRHNrCjl5WEF1dDFybC9seEhzbThsYVJwbnRoR1lPZ0VNT09TREd2dGpscjU0UEJmNk51enJRRUZjU2FCVzUxS3VZZWEKTTFueGY2b3J2VklEcGVjYzZKWG50ajVka1Z4eWg4MktxM2dkOU5BMmZjbXoxVEIzdWlhR2tVV053UUtCZ1FDVQp4SnpFa2I5M3RLWjRJQUNPNHh4Sml6N1hLTmVwS29xY0V4MnU0OGxSb0tJeCsvanhZNk9DSEV4V0FRS1BLbXk5CnJMNVBrYTRzMHVFcnQrMGJ1cGYyMjBxUEJkV1A1dWV6K3MxQlFuUlNBMm5waFUxRE9MYjR1cjV1SnowanY1NlgKOTFhcE9UNnZHZEhtMEtxWEQvSFllZHZZRHJJK1FBM2puTUEwTHMrSUpRS0JnUUMxeWoyUzVxb2pCcW5WNy80MAoyY1l5MFpKOXhhb1IxSHd4OGJHNFh3a0U4Z2MwSXN5cSszcEZwY0xlUTFzSURiT0JXaVpIeHV0aFlJRlViNHVhCmtSVkxZb1Z6eGFxK2FQYkFrcEQvT2EraUkvYW8ydVErbUdZRnJCd2lsZkZPZHZWZE5YNkprQUdoWDQwUjJvNk0KZTZLVnc1TTU4cHFKK3FVZDNMQ2xvY3l3Umc9PQotLS0tLUVORCBQUklWQVRFIEtFWS0tLS0t
metadata:
 name: echo-tls
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: echo-server
  namespace: default
spec:
  replicas: 1
  selector:
    matchLabels:
      run: echo-server
  template:
    metadata:
      labels:
        run: echo-server
    spec:
      containers:
      - name: echo-server
        image: mendhak/http-https-echo:26
        volumeMounts:
        - name: certs
          mountPath: /app/privkey.pem
          subPath: privkey.pem
        - name: certs
          mountPath: /app/fullchain.pem
          subPath: fullchain.pem
      volumes:
      - name: certs
        secret:
          secretName: echo-tls
          items:
           - key: fullchain.pem
             path: fullchain.pem
           - key: privkey.pem
             path: privkey.pem
---
apiVersion: v1
kind: Service
metadata:
  name: echo-server
  namespace: default
spec:
  ports:
  - name: http
    appProtocol: http
    port: 8080
    targetPort: 8080
  - name: https
    appProtocol: http
    port: 8443
    targetPort: 8443
  selector:
    run: echo-server
  sessionAffinity: None
  type: ClusterIP
---
apiVersion: v1
kind: Namespace
metadata:
  name: es-test
  annotations:
    kuma.io/sidecar-injection: "enabled"
---
apiVersion: kuma.io/v1alpha1
kind: ExternalService
mesh: default
metadata:
  name: echo-server
spec:
  tags:
    kuma.io/service: echo-server
    kuma.io/protocol: http # optional, one of http, http2, tcp, grpc, kafka
  networking:
    address: echo-server.default.svc.cluster.local:8443
    tls: # optional
      enabled: true
      allowRenegotiation: false
      caCert: # one of inline, inlineString, secret
        inline: CgotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJRFNqQ0NBaklDQ1FDNHRwODFrT0RNWVRBTkJna3Foa2lHOXcwQkFRc0ZBREJuTVFzd0NRWURWUVFHRXdKVgpVekVOTUFzR0ExVUVDQXdFVlhSaGFERU9NQXdHQTFVRUJ3d0ZVSEp2ZG04eEl6QWhCZ05WQkFvTUdrRkRUVVVnClUybG5ibWx1WnlCQmRYUm9iM0pwZEhrZ1NXNWpNUlF3RWdZRFZRUUREQXRsZUdGdGNHeGxMbU52YlRBZUZ3MHkKTURBME1qQXhOVEl5TlRGYUZ3MDBOekE1TURVeE5USXlOVEZhTUdjeEN6QUpCZ05WQkFZVEFsVlRNUTB3Q3dZRApWUVFJREFSVmRHRm9NUTR3REFZRFZRUUhEQVZRY205MmJ6RWpNQ0VHQTFVRUNnd2FRVU5OUlNCVGFXZHVhVzVuCklFRjFkR2h2Y21sMGVTQkpibU14RkRBU0JnTlZCQU1NQzJWNFlXMXdiR1V1WTI5dE1JSUJJakFOQmdrcWhraUcKOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXVhMEFkZDBndUhETUxvRWY2QTFoajVaeFpmVmQrc3dQbmNQdwo4WkwxZlN6VjBwbmd4TVRFLzN2a2VmaHozakUrUjRiMERRTHNmWVZqb2hETUVUZnFSRVJmd1o1SGNwc1p4MHBDCkZ4b2I3SWN0eTJ0UHdSaWpMbnV0Y1pCZzRFTkJxWWVDMy9EUXVPKzdBRFY1QTF1bEZkT2NKdVhOQm1OcHNIMlIKbUV1dnRyb0dqeEFNSld2b1V1ODk5c25IYUlzcmNwQUpFZGdjWUY3a2pIRWZVNEt2MnBtTEh4MW5IQUYzcWI1Mwptak1QMFJkb2VGREcvQXVFUWdCNlZtSGMvOU56NDE2bzlFMktrckI1R0dsOHQ5V1ZwdEtIUWZxRVUrU256eWZiCnk5clJndzkwR1V6Ukx5bEJpSENHVU5wUTRmZW5EK2xWbnB1a281eXFFRGFKVllzWXp3SURBUUFCTUEwR0NTcUcKU0liM0RRRUJDd1VBQTRJQkFRQW9UdmJad25lSzVVa3QxcnFXb2crUkVicGNTQTZKWlJxWTdycTNxS0twT0Q1NgpQeHc0dERBUi93NWNWK3E0RlBFZFhYK3ppd3o2M3JPcUQxZ1FtdUMvcFBBNzZORjVpYnlhRExTcnR3L2RXcWlVCnlYc0xNRGFJaGEraVJVdDVnTTk3MGcvOVdkbENyY2IwL3ZJc1JTdjI4WUNLTyt2OHFJOHVtVmNWa3BYNmR6WCsKOVUrUnlZaFZBZnZPSzFEdC9yenlXQnNWaXZjK1BINDJDOE9zOWNqZnhxT2hydGFYcno0ZGUyNytQQlVBQ3lERgp5a0FDM21RRkFidHNBZjgvWks2cWpjS3A2Sm5FY2c0YW9TQVl4TzdwdDZib3F1WW05bVl2WG9ta3FKY1dFc29YCmpnQm0wV2tqQWV6WXJOalVKcW5XclMya3FsTUY2TXJtTWxIc3hXYXQKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQ==
      clientCert: # one of inline, inlineString, secret
        inline: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURaRENDQWt5Z0F3SUJBZ0lKQVBVeUFmcExHYnQ0TUEwR0NTcUdTSWIzRFFFQkJRVUFNR2N4Q3pBSkJnTlYKQkFZVEFsVlRNUTB3Q3dZRFZRUUlEQVJWZEdGb01RNHdEQVlEVlFRSERBVlFjbTkyYnpFak1DRUdBMVVFQ2d3YQpRVU5OUlNCVGFXZHVhVzVuSUVGMWRHaHZjbWwwZVNCSmJtTXhGREFTQmdOVkJBTU1DMlY0WVcxd2JHVXVZMjl0Ck1CNFhEVEl3TURVeE1USXhORFUwT1ZvWERUUTNNRGt5TmpJeE5EVTBPVm93WFRFTE1Ba0dBMVVFQmhNQ1ZWTXgKRFRBTEJnTlZCQWdNQkZWMFlXZ3hEakFNQmdOVkJBY01CVkJ5YjNadk1SWXdGQVlEVlFRS0RBMUJRMDFGSUZSbApZMmdnU1c1ak1SY3dGUVlEVlFRRERBNXRlUzVsZUdGdGNHeGxMbU52YlRDQ0FTSXdEUVlKS29aSWh2Y05BUUVCCkJRQURnZ0VQQURDQ0FRb0NnZ0VCQUtGSk5mSTM4aEIyc2xvcVIvdWQyR0VYNG1wdlJJdDJnUG5NSHNiZW9pYVcKcHBGbTI1VmZLbzVaZ25ra3Y1TndIbVJjcG1iNDNjNU5MVVR1Q0tRRm9qcDM1WEJ5SVZhaEI1cWpETW5uaWM4LwpULzNJanIyNjRqSmVpNk5Kb0dFaGNrcHJDS3JKY3BWRllmSXBlc01lM3MySHlKVkt0MnhkVVgrZVlQZ3RQcFpiCjVHVlpWblFjaW5pR09lZDV1RVMrVnkrM0RJZHlhZWlIcFVUWk5wQmhvcFdncVVsL3JTMXF6RVZ5V3EvMUd5ckcKeGVUaEJVSEpidnJ1eDJnZE9GeDZicmFsVGZDeFRxdGVFSEUwQ3Y3Tld5SG9IMGJyS3hWOVRYZzh2SWF0MDFpdAo5bnlVRDNCOWpOdUkzSlpiRmtrNlZpbERsWnNxZE1BZzh6aEM3TktTT1I4Q0F3RUFBYU1kTUJzd0dRWURWUjBSCkJCSXdFSVlPYzNCcFptWmxPaTh2WldOb2J6SXdEUVlKS29aSWh2Y05BUUVGQlFBRGdnRUJBQldUTHh4dFFNaGMKR0ovcWpIVUhzalJaakhuUTRpNURINS8xbkU0RXU2aTZMRHhjQS9UdDJwanlPRTgvV2VXNmt0Y0M1TlZGN1VMNgphKzd4T29HNFROTTVzODNpdTk5aTdNZWtMVEYrQTBYUHI0WGtFbjFmSWFsRnF6UlV3MU1EZUttMjdwR0Y0MlFhClF4Y1pTRjZwSGpWK1FUemJRN2l3TDl0VDN5SCtPMTNjWWtxTkQ4Y25KdEdnMGlUeDA5eGlBYnhEK0RZZWNUMS8KSGNja3FPMW5jYS9GWmxIQTZaMUVsY1E2MEdyRm1PT0o0eHN6Rk5nNlE3Wmt5WE12aEtJSng4cVhyVWlSdlBPbgpmejBqcjFWMlRYOXBDYXhMKzYwTzlsaEtyeE1LVG5YOXVqNytuQjRxYTVwTnhFcWpTVy8razFiSnlKckdjT1NtCmt0MDVhOGhNdzRrPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0t
      clientKey: # one of inline, inlineString, secret
        inline: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb2dJQkFBS0NBUUVBb1VrMThqZnlFSGF5V2lwSCs1M1lZUmZpYW05RWkzYUErY3dleHQ2aUpwYW1rV2JiCmxWOHFqbG1DZVNTL2szQWVaRnltWnZqZHprMHRSTzRJcEFXaU9uZmxjSEloVnFFSG1xTU15ZWVKeno5UC9jaU8KdmJyaU1sNkxvMG1nWVNGeVNtc0lxc2x5bFVWaDhpbDZ3eDdlellmSWxVcTNiRjFSZjU1ZytDMCtsbHZrWlZsVwpkQnlLZUlZNTUzbTRSTDVYTDdjTWgzSnA2SWVsUk5rMmtHR2lsYUNwU1grdExXck1SWEphci9VYktzYkY1T0VGClFjbHUrdTdIYUIwNFhIcHV0cVZOOExGT3ExNFFjVFFLL3MxYkllZ2ZSdXNyRlgxTmVEeThocTNUV0szMmZKUVAKY0gyTTI0amNsbHNXU1RwV0tVT1ZteXAwd0NEek9FTHMwcEk1SHdJREFRQUJBb0lCQUZVRE1kd3FnUDBNazVYVApFMzRkQlNDb1pqK1R4cDE4S1IrQjUvY0xBbzAwZXpmSTc1VWNSR0lqN0JIT3ZPd0ovUHNKbXV4TDRSNE1yLy9WCk45aTgzM1hTSEszWWVwb2U1dE1yZm1JdUdRV1VhYVZyUVZIZ1g3b00rNjFsOFpOQS9lMGIzY1dueVMzRkZJdUEKTWFVSGNJa0ZPVVQzelJiaFdVUGJSMkdJOTZSb2xPV0NPT3VhSUNua1hjTU9CdVoza0pHV0xhTmhhZHZ3cTRGMAo1d0wxNGlGL21hbVhGd0UxZzF0STRIVVhlalBrTEpjTFFFMW04ZEI3NTZLajZDQkVrcmtvbmZnVVdCUWVCbVlqCjhaTnV0U2dZbFErd3JsaEl5aCsrNjZSOW13Z2tRaVFDMTNFM05YUis1Nmw0Uy9naUV3ZG93OHFCbkRRTGFIR0YKSnFmNTI0RUNnWUVBMDgweVE4YlA2RVpnTldJUDFGd0Z5NkxraExOWDRIN1NGMjhRYjQwQ09Qbk03bjgrZkp1bApPazBQbGowNFZ3bnUxdXJRTXZGME9FNTVGRCtUTjJlaVUyY3VnUXNpL25YTnVlLzdXN2o4RlBOTFdyNHg3ZGJmCmlEVGRtR1cza3RYdThpU1BCZGZ4TnU1dHZtZ1p1Zk8wWk1ncFQ5UG1vekQ0YUxEVTI5OUUzOFVDZ1lFQXd2RmkKdWg1bFZBYTNrYS9rNVV4ejFzYkJPWC9PRTg3R043d3JYaUxSVXVnT2svTE5HaGo0cERtQ3NmYytYMEd6U202dgpFQWJEZmg1T29RY0VEZmZ6bC9LbjFrSkRYNjM5T3B2eFB3d3dUbTZLU3BSTkhXYUZ6UWFZVStONDdHWkxObzdECmdBVktQYWFGdm00TVVXd1JFTHNoaW9iVzZ5RVEyanV0NnF3bmY1TUNnWUFjY3d5VVpBa2JOeERIT3VQTGI0enIKdkhhYmlJZCtSU3F0TVNMeENPektnR3RSZ2MvLzV0dzd4NHdYYnlPNU5VRmFwdkhPVmZaNWRiajN5azVZKzllbgpBazRSMFZBakErbmRWdW5aZVRDTEU5OEVVbFhjajZjNDRYaitkbk5CQ3ZGc254S0RBMjJJSm1DaFdkUlMwUFJqCk1TdXphRkFyalhGZ2hwZ2c3STJRelFLQmdIV3F5aExab2dQMEFmMjRGQXVyK0FmZDlHZkdreGMxcWtPZUd2YzUKUU93d0VneVBjK21heFFvcmhJM3pWUHllWmFBNTZ3VmJiOGpDZG1lUUdveHI2K2I5bXYwakJoUE1xNXNpNFoxUwp1QjIvYjAzUThqTWEzUXlDUEpQMks5bFZiWFRDKzVKY254RlRZRXN2bGRQWHpQMHlWdTZNc1ZFL3BqSno3MmhFCi9acHRBb0dBYlh1cVBSYmVsL2Rza2xDbXZDZG45MjV2c01UekpuV2picEpKRnJHYmxUV2srUWZyWUFkQ20xTSsKRDlzU0l3anFYMWFpak5Wa01TVFFsNSt1dlR5YVkreDQwVTNidzlRRnUwMFZ3QVFhUTdsOTRQQlpvZm03Mm1HMgpyOGVyeWgvaDhid2l2NUlEcWRJbXRIVkVRL2xENm95NllLb0RjeFFHV3M1dFlBMHpwUlE9Ci0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0t
---
apiVersion: kuma.io/v1alpha1
kind: ExternalService
mesh: default
metadata:
  name: echo-server-plain
spec:
  tags:
    kuma.io/service: echo-server-plain
    kuma.io/protocol: http # optional, one of http, http2, tcp, grpc, kafka
  networking:
    address: echo-server.default.svc.cluster.local:8080
